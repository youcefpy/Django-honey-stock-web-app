{% extends 'base.html' %}

{% block title %}LIST DES ETTIQUETE{% endblock %}

{% block content %}
    <table class='table table-bordered'>
        <thead>
            <tr>
                <th>Type</th>
                <th>Product Name</th>
                <th>Quantity in Stock</th>
                <th>Weighted Average Price</th>
                <th>History of Purchase/Batch</th>
                <th>Delete Ticket</th>
            </tr>
        </thead>
        <tbody>
            {% for ticket in tickets %}
            <tr>
                <td>{{ ticket.get_type_ticket_display }}</td>
                <td>{{ ticket.product.name_product }}</td>
                <td>{{ ticket.quantity_in_the_stock  }}</td>
                <td>{{ ticket.weighted_average|floatformat:2 }}</td>
                <td>
                    <ul>
                    {% for batch in ticket.ticketbatch_set.all %}
                        <li>
                            Date: {{ batch.date_received }},
                            Quantity: {{ batch.quantity_received }},
                            Price/Ticket: {{ batch.purchase_price }},
                            <form action="{% url 'delete_ticket_batch' batch.id %}" method="post" onsubmit="return confirmDeleteBatch();">
                                {% csrf_token %}
                                <button class='btn btn-danger'>Delete Batch</button>
                            </form>  
                        </li>
                    {% endfor %}
                    </ul>
                </td>
                <td>
                    <form action="{% url 'delete_ticket' ticket.id %}" method="post" onsubmit="return confirmDelete();">
                        {% csrf_token %}
                        <button class='btn btn-danger'>Delete Ticket</button>
                    </form> 
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

{% endblock %}


<script>
    function confirmDelete() {
        return confirm("Do you really want to delete this ticket and its batches?");
    }
    function confirmDeleteBatch() {
        return confirm("Do you really want to delete this batch?");
    }
</script>
